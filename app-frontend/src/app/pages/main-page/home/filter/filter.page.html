<ion-content>
    <ng-container *ngIf="!questionSet">
        <div>
            <div class="pnl-title">
                <h3>設定篩選條件</h3>
                <small>設定完畢後請點擊開始查詢按鈕</small>
            </div>
            <ion-list>
                <ion-list-header>
                    <ion-label>主題</ion-label>
                </ion-list-header>
                <div class="pnl-topics">
                    <ng-container *ngFor="let level1Tag of tags">
                        <ion-chip (click)="onBtnAddTopicClicked(level1Tag.text)">
                            <ion-icon name="checkmark" *ngIf="(topics.indexOf(level1Tag.text) > -1)"></ion-icon>
                            <ion-label>{{ level1Tag.text }}</ion-label>
                        </ion-chip>
                        <ng-container *ngIf="level1Tag.tags">
                            <ng-container *ngFor="let level2Tag of level1Tag.tags">
                                <ion-chip (click)="onBtnAddTopicClicked(level2Tag.text)">
                                    <ion-icon name="checkmark" *ngIf="(topics.indexOf(level2Tag.text) > -1)"></ion-icon>
                                    <ion-label>{{ level2Tag.text }}</ion-label>
                                </ion-chip>
                                <ng-container *ngIf="level2Tag.tags">
                                    <ng-container *ngFor="let level3Tag of level2Tag.tags">
                                        <ion-chip (click)="onBtnAddTopicClicked(level3Tag.text)">
                                            <ion-icon name="checkmark" *ngIf="(topics.indexOf(level3Tag.text) > -1)"></ion-icon>
                                            <ion-label>{{ level3Tag.text }}</ion-label>
                                        </ion-chip>
                                    </ng-container>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
                
            </ion-list>
            
            <ion-list>
                <ion-list-header>
                    <ion-label>查詢方式</ion-label>
                </ion-list-header>
                <ion-radio-group [(ngModel)]="type">
                    <ion-item>
                        <ion-radio slot="start" value="AND"></ion-radio>
                        <ion-label>AND</ion-label>
                    </ion-item>
                    <ion-item>
                        <ion-radio slot="start" value="OR"></ion-radio>
                        <ion-label>OR</ion-label>
                    </ion-item>
                </ion-radio-group>
            </ion-list>

            <div class="pnl-query ion-text-center">
                <ion-button (click)="onBtnQueryClicked()" *ngIf="topics.length > 0">
                    開始查詢
                </ion-button>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="questionSet">
        <ion-item lines="full">
            <ion-label>記住進度</ion-label>
            <ion-toggle [(ngModel)]="isAutoSave" (ionChange)="onAutoSaveChange($event)"></ion-toggle>
        </ion-item>
        <ion-grid>
            <ion-row>
                <ion-col size="12">
                    <ion-chip *ngFor="let topic of topics">
                        <ion-label>{{ topic }}</ion-label>
                    </ion-chip>
                </ion-col>

                <ion-col size="12" *ngIf="questionSet.source || questionSet.url">
                    <div class="pnl-source">
                        <div><a href="{{ questionSet.url }}" target="_blank">{{ questionSet.source }}</a></div>
                        <div><small>{{ questionSet.url }}</small></div>
                    </div>
                </ion-col>

                <ion-col size="12" *ngIf="questionSet.content">
                    {{ questionSet.content }}
                </ion-col>

                <ion-col size="12" *ngFor="let question of questionSet?.questions; let i = index">
                    <ion-list>
                        <ion-item [innerHtml]="question.content"></ion-item>
                        <ion-radio-group>
                            <ion-item *ngFor="let option of question.options">
                                <ion-radio slot="start" value="{{ option.content }}"></ion-radio>
                                <ion-label>{{ option.content }}</ion-label>
                                <ion-icon slot="end" *ngIf="isShowAnswer[i]" name="{{ option.isAnswer ? 'checkmark' : 'close' }}">
                                </ion-icon>
                            </ion-item>
                        </ion-radio-group>
                        <ion-item *ngIf="isShowAnswer[i]" [innerHtml]="question.comment"></ion-item>
                        <ion-item>
                            <ion-label>顯示答案</ion-label>
                            <ion-toggle [(ngModel)]="isShowAnswer[i]"></ion-toggle>
                        </ion-item>
                    </ion-list>
                </ion-col>
            </ion-row>
        </ion-grid>

        <ion-grid>
            <ion-row>
                <ion-col class="ion-text-center">
                    <div>
                        <ion-button (click)="onBtnQueryPreviousClicked()" *ngIf="current > 1">上一題</ion-button>
                        <ion-button (click)="onBtnQueryNextClicked()" *ngIf="current < total">下一題</ion-button>
                    </div>
                    <p class="ion-text-center">
                        <small>{{ current }} / {{ total }}</small>
                    </p>
                </ion-col>
            </ion-row>
        </ion-grid>
    </ng-container>
</ion-content>
